<!DOCTYPE html>
<html>
  <head>
    
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <link rel="manifest" href="/favicons/site.webmanifest">

  
  
  <title>DEVLOG W | 문제 풀이로 알아보는 자바스크립트 클로저</title>

  
  <link rel="stylesheet" type="text/css" href="/sass/layout.min.981eba9c7afc1cd03a5f0ea93107e171972b8bc5788b91f11d9d444c9f71e9b6.css">

  
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YE709CKLGF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', "G-YE709CKLGF");
</script>

  
</head>


  
  <link rel="stylesheet" type="text/css" href="/sass/single.min.7589dc3d1b93e121732881f1a3e21aeb3d0076e7e92093bcf63fe04b657af52c.css">

  </head>
<body>
  <header>
    <div id="header-wrapper">
  <a href="/"><h1 id="header-title">DEVLOG W</h1></a>

  <menu id="header-menu">
    
      <li class="header-menu-item">
        
        

        <a href="/" target="_self">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>
        </a>
      </li>
      <li class="header-menu-item">
        
        

        <a href="https://github.com/wcho21" target="_blank">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
        </a>
      </li>
  </menu>
</div>
  </header>
  <main>
    
  <article id="article">
    <h1 id="article-heading">문제 풀이로 알아보는 자바스크립트 클로저</h1>
    <p id="article-date">2022-10-09</p>

    <div id="article-content">
      <p>예전에 어떤 영상을 보다가 재미있는 문제를 본 적이 있다. 다음 코드의 결과는 무엇일까?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">var</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">3</span>; <span style="color:#ff79c6">++</span>i) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> log <span style="color:#ff79c6">=</span> () =&gt; { console.log(i); };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  setTimeout(log, <span style="color:#bd93f9">1000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>내가 이 문제를 처음 봤을 때 답이 <code>1 2 3</code>이라고 생각했지만, 실제 결과는 <code>3 3 3</code> 이다.
이 글에서는 그 이유를 간략히 알아보려고 한다.</p>
<h2 id="tldr">TL;DR</h2>
<ol>
<li>
<p>함수는 외부 변수의 레퍼런스를 저장한다.</p>
</li>
<li>
<p>문제의 함수들은 같은 변수의 레퍼런스를 갖고 있기 때문에 같은 값을 출력했다.</p>
</li>
<li>
<p><code>var</code>는 블록 스코프가 아닌 함수 스코프를 따른다. 그러므로 변수 선언은 호이스팅되어 블록을 뚫고 위로 올라갈 수 있다.</p>
</li>
</ol>
<h2 id="클로저">클로저</h2>
<p>내가 이해한 클로저의 키 컨셉은, 외부 변수를 레퍼런스로 저장해둔다는 것이다.</p>
<h3 id="간단한-예시">간단한 예시</h3>
<p>다음 코드의 <code>nextNumber()</code> 함수를 주목해보자.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> n <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> nextNumber() {
</span></span><span style="display:flex;"><span>  n <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">return</span> n;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nextNumber(); <span style="color:#6272a4">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>nextNumber(); <span style="color:#6272a4">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>nextNumber(); <span style="color:#6272a4">// 3
</span></span></span></code></pre></div><p>여기서 <code>nextNumber()</code> 함수는 변수 <code>n</code>을 어떻게 알고 있을까?</p>
<p>이 함수가 초기화될 때, 함수는 밖에서 정의된 변수 <code>n</code>의 레퍼런스를 저장해둔다.</p>
<aside class="callout-note">
  <h1 class="callout-note-heading">클로저가 저장되는 곳</h1>

  
  
    <p>레퍼런스가 저장되는 곳은 스택인가, 힙인가?
그것은 클로저가 언어 상 어떻게 구현되어 있느냐에 달렸다.</p>
  
</aside>
<h3 id="문제의-클로저">문제의 클로저</h3>
<p>먼저, <code>var</code>로 선언된 변수는 호이스팅되어 선언이 맨 위로 올라간다.
그러면 원래의 문제는 다음 문제로 바꿔 쓸 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> i; <span style="color:#6272a4">// hoisted
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">for</span> (i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">3</span>; <span style="color:#ff79c6">++</span>i) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> log <span style="color:#ff79c6">=</span> () =&gt; { console.log(i); };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  setTimeout(log, <span style="color:#bd93f9">1000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>왜 결과가 <code>3 3 3</code>이 될까? 그 이유는 다음과 같다.</p>
<ul>
<li>
<p><code>log</code> 함수는 전역 변수 <code>i</code>의 레퍼런스를 기억해둔다.</p>
<p>이때, 세 개의 <code>log</code> 함수가 같은 전역 변수 <code>i</code>를 참조하게 된다.</p>
</li>
<li>
<p><code>setTimout</code>으로 인해 1초 뒤에 <code>log</code> 함수가 호출된다. 이 함수는 <code>i</code>를 참조한다.</p>
<p><code>for</code> 루프가 끝난 뒤이므로, 그 값은 세 번 모두 <code>3</code>이 된다.</p>
</li>
</ul>
<h2 id="let의-경우"><code>let</code>의 경우</h2>
<p>이번에는 문제에서 변수 선언을 <code>let</code> 키워드로 바꿨을 때 어떤지 알아보자.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">let</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">3</span>; <span style="color:#ff79c6">++</span>i) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> log <span style="color:#ff79c6">=</span> () =&gt; { console.log(i); };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  setTimeout(log, <span style="color:#bd93f9">1000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>이 경우는 결과가 <code>0 1 2</code>가 된다. 왜인가?</p>
<p><code>for</code> 루프에서 <code>i</code> 변수는 매번 새로 초기화된다는 점을 참고하자.
따라서 각 루프마다 <code>log</code> 함수가 스코프 내에서 알 수 있는 변수 <code>i</code>는 매번 다른 변수 <code>i</code>가 된다.</p>
<p>다시 말해 <code>log</code> 함수는 매번 다른 <code>i</code> 변수의 레퍼런스를 기억한 클로저가 된다.
각각의 값은 <code>0 1 2</code>이므로, 출력 결과도 그렇게 된다.</p>
<h2 id="레퍼런스">레퍼런스</h2>
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=vKJpN5FAeF4">Closures Explained in 100 Seconds</a>: 이 영상의 문제와 해설을 참고했다.</p>
</li>
<li>
<p>그런데 잘 알려진 문제인 듯하다. 얼마전에 <a href="https://naamukim.tistory.com/11">다른 캠퍼분의 포스팅</a>에서도 소개가 되어있는 걸 보았는데, 이걸 보고 이 글을 쓰기로 했다.</p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/59170277/javascript-understanding-let-scope-inside-for-loop">Understanding let scope inside for loop</a>:
만약 <code>for</code> 문이 <code>i</code> 변수를 초기화한 뒤 <code>1</code>씩 증가시키며 같은 <code>i</code> 변수를 사용했다면, 모든 클로저는 같은 변수 <code>i</code>를 참조했을 것이다.
<code>for</code> 문이 매 루프마다 <code>i</code> 변수를 새로 초기화한다는 사실은 이러한 이유 때문에 본문에서 언급하였다.</p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/29225834/where-are-variables-in-a-closure-stored-stack-or-heap">Where are variables in a closure stored - stack or heap?</a>, <a href="https://stackoverflow.com/questions/16959342/javascript-closures-on-heap-or-stack">Javascript closures on heap or stack?</a>:
클로저가 레퍼런스를 어디에 저장하는가에 관한 질문이다. 결론은 &lsquo;구현마다 다르다&rsquo;이다.</p>
</li>
</ul>

    </div>
  </article>

  <div id="comments">
    <script src="https://utteranc.es/client.js" repo="wcho21/hugo-blog-comments" issue-term="pathname" theme="dark-blue" crossorigin="anonymous" async></script>
  </div>

  <ul id="pagination">
    
      <li class="pagination-article">
        <a href="/2022/10/02/boostcamp-week-4-retrospective/">
          <div class="pagination-article-title">
            <span class="pagination-article-title-label">이전 글:</span>
            부스트캠프 7기 멤버십 4주차 회고
          </div>
        </a>
      </li>
    
    
  </ul>

  </main>
  <footer>
    <div id="footer-wrapper">
  <p id="footer-copyright">&copy; 2022 DEVLOG W.</p>
  <p id="footer-contact">wcho.dev@gmail.com</p>
</div>
  </footer>
</body>
</html>